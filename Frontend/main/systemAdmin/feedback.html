<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - View Feedback</title>
  <link rel="stylesheet" href="feedback.css">
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <a class="dashboardLink" href="#">E-Diacare</a>
      <ul>
        <li><a href="systemAdminDashboard.html">Dashboard Overview</a></li>
        <li><a href="adminProfile.html">View Profile</a></li>
        <li><a href="healthFacilities.html">Health Facilities Database</a></li>
        <li><a href="physicianDatabase.html">Physician Database</a></li>
        <li><a href="PatientDatabase.html">Patient Database</a></li>
        <li><a href="feedback.html">View Feedback</a></li>
        <li><a href="../Home/index.html">Logout</a></li>
      </ul>
    </div>
    <div class="main-content-wrapper">
      <header class="header">
        <h1 class="welcome-title">View Feedback</h1>
        <span class="userName">Mr. Mekat</span>
        <div class="dropdown">
          <input type="checkbox" id="dropdown-toggle" class="dropdown-checkbox">
          <label for="dropdown-toggle" class="dropbtn">
            <img src="images/DrMekat.jpg" alt="Profile Icon" class="profile-icon" height="40" width="40">
          </label>
          <div class="dropdown-content">
            <a href="#profile">Profile</a>
            <a href="#settings">Settings</a>
            <a href="../Home/index.html">Logout</a>
          </div>
        </div>
      </header>

      <div class="content">
        <table id="feedbackTable">
          <thead>
            <tr>
              <th>ReviewID</th>
              <th>Stars</th>
              <th>Date</th>
              <th>Description</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="feedbackData">
            <!-- Data will be displayed here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <script>
      const API_URL = 'http://localhost:6000';

      async function fetchtbl_review() {
          try {
              const response = await fetch(`${API_URL}/api/tbl_review`);
              const tbl_review = await response.json();
              rendertbl_review(tbl_review);
          } catch (error) {
              console.error('Failed to fetch tbl_review:', error);
          }
      }

      function rendertbl_review(tbl_review) {
          const tableBody = document.querySelector('#feedbackTable tbody');
          tableBody.innerHTML = '';

          tbl_review.forEach(review => {
              const row = tableBody.insertRow();
              row.insertCell(0).textContent = review.ReviewID;
              row.insertCell(1).textContent = review.Stars;
              row.insertCell(2).textContent = review.Date;
              row.insertCell(3).textContent = review.Description;

              const actionsCell = row.insertCell(4);
              actionsCell.className = 'action-buttons';

              const updateButton = document.createElement('button');
              updateButton.textContent = 'Update';
              updateButton.onclick = () => updatetbl_review(review.ReviewID, review.Stars, review.Date, review.Description);

              const deleteButton = document.createElement('button');
              deleteButton.textContent =        actionsCell.appendChild(updateButton);
          actionsCell.appendChild(deleteButton);
      });
    }

    async function updatetbl_review(ReviewID, currentStars, currentDate, currentDescription) {
        const Stars = prompt('Enter Stars (Y/N):', currentStars);
        const Date = prompt('Enter Date (YYYY-MM-DD):', currentDate);
        const Description = prompt('Enter Description:', currentDescription);

        if (Stars && Date && Description) {
            try {
                const response = await fetch(`${API_URL}/api/tbl_review/${ReviewID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ Stars, Date, Description }),
                });

                if (response.ok) {
                    alert('Review updated successfully');
                    fetchtbl_review();
                } else {
                    alert('Failed to update review');
                }
            } catch (error) {
                console.error('Failed to update review:', error);
            }
        }
    }

    async function deletetbl_review(ReviewID) {
        if (confirm('Are you sure you want to delete this review?')) {
            try {
                const response = await fetch(`${API_URL}/api/tbl_review/${ReviewID}`, {
                    method: 'DELETE',
                });

                if (response.ok) {
                    alert('Review deleted successfully');
                    fetchtbl_review();
                } else {
                    alert('Failed to delete review');
                }
            } catch (error) {
                console.error('Failed to delete review:', error);
            }
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        fetchtbl_review();
    });
  </script>
</body>
</html>
