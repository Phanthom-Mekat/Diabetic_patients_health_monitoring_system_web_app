<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - View Feedback</title>
  <style>
    body {
        font-family: Arial, sans-serif;
        background-color: #1E1E2F;
        color: #FFFFFF;
        margin: 0;
        padding: 0;
    }

    .container {
        display: flex;
        height: 100vh;
    }

    .sidebar {
        background-color: #252540;
        width: 250px;
        padding: 20px;
        box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    }

    .sidebar a {
        color: #FFFFFF;
        text-decoration: none;
        display: block;
        margin: 20px 0;
        font-size: 18px;
    }

    .sidebar ul {
        list-style-type: none;
        padding: 0;
    }

    .sidebar ul li {
        margin: 20px 0;
    }

    .main-content-wrapper {
        flex-grow: 1;
        padding: 20px;
        overflow-y: auto;
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .welcome-title {
        font-size: 24px;
    }

    .userName {
        margin-right: 20px;
    }

    .dropdown {
        position: relative;
        display: inline-block;
    }

    .dropdown-checkbox {
        display: none;
    }

    .dropbtn img {
        border-radius: 50%;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
    }

    .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
    }

    .dropdown-checkbox:checked + .dropbtn + .dropdown-content {
        display: block;
    }

    .content {
        margin-top: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background-color: #2A2A48;
    }

    table, th, td {
        border: 1px solid #4A4A6A;
    }

    th, td {
        padding: 10px;
        text-align: left;
    }

    th {
        background-color: #35354E;
    }

    .actions {
        display: flex;
        gap: 10px;
    }

    button {
        background-color: #FF6384;
        border: none;
        color: white;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 5px;
    }

    button.delete {
        background-color: #FF6384;
    }

    button.addToDashboard {
        background-color: #36A2EB;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <a class="dashboardLink" href="#">E-Diacare</a>
      <ul>
        <li><a href="systemAdminDashboard.html">Dashboard Overview</a></li>
        <li><a href="adminProfile.html">View Profile</a></li>
        <li><a href="healthFacilities.html">Health Facilities Database</a></li>
        <li><a href="physicianDatabase.html">Physician Database</a></li>
        <li><a href="PatientDatabase.html">Patient Database</a></li>
        <li><a href="feedback.html">View Feedback</a></li>
        <li><a href="index.html">Logout</a></li>
      </ul>
    </div>
    <div class="main-content-wrapper">
      <header class="header">
        <h1 class="welcome-title">View Feedback</h1>
        <span class="userName">Mr. Mekat</span>
        <div class="dropdown">
          <input type="checkbox" id="dropdown-toggle" class="dropdown-checkbox">
          <label for="dropdown-toggle" class="dropbtn">
            <img src="images/DrMekat.jpg" alt="Profile Icon" class="profile-icon" height="40" width="40">
          </label>
          <div class="dropdown-content">
            <a href="#profile">Profile</a>
            <a href="#settings">Settings</a>
            <a href="index.html">Logout</a>
          </div>
        </div>
      </header>

      <div class="content">
        <table id="feedbackTable">
          <thead>
            <tr>
              <th>ReviewID</th>
              <th>Stars</th>
              <th>Date</th>
              <th>Description</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="feedbackData">
            <!-- Data will be displayed here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <script>
      const API_URL = 'http://localhost:8000/feedback';

      async function fetchtbl_review() {
          try {
              const response = await fetch(`${API_URL}/api/tbl_review`);
              const tbl_review = await response.json();
              rendertbl_review(tbl_review);
          } catch (error) {
              console.error('Failed to fetch tbl_review:', error);
          }
      }

      function rendertbl_review(tbl_review) {
          const tableBody = document.querySelector('#feedbackTable tbody');
          tableBody.innerHTML = '';

          tbl_review.forEach(review => {
              const row = tableBody.insertRow();
              row.insertCell(0).textContent = review.ReviewID;
              row.insertCell(1).textContent = review.Stars;
              row.insertCell(2).textContent = review.Date;
              row.insertCell(3).textContent = review.Description;

              const actionsCell = row.insertCell(4);
              actionsCell.className = 'action-buttons';

              const updateButton = document.createElement('button');
              updateButton.textContent = 'Update';
              updateButton.onclick = () => updatetbl_review(review.ReviewID, review.Stars, review.Date, review.Description);

              const deleteButton = document.createElement('button');
              deleteButton.textContent = 'Delete';
              deleteButton.onclick = () => deletetbl_review(review.ReviewID);

              actionsCell.appendChild(updateButton);
              actionsCell.appendChild(deleteButton);
          });
      }

      async function updatetbl_review(ReviewID, currentStars, currentDate, currentDescription) {
          const Stars = prompt('Enter Stars (Y/N):', currentStars);
          const Date = prompt('Enter Date (YYYY-MM-DD):', currentDate);
          const Description = prompt('Enter Description:', currentDescription);

          if (Stars && Date && Description) {
              try {
                  const response = await fetch(`${API_URL}/api/tbl_review/${ReviewID}`, {
                      method: 'PUT',
                      headers: {
                          'Content-Type': 'application/json',
                      },
                      body: JSON.stringify({ Stars, Date, Description }),
                  });

                  if (response.ok) {
                      alert('Review updated successfully');
                      fetchtbl_review();
                  } else {
                      alert('Failed to update review');
                  }
              } catch (error) {
                  console.error('Failed to update review:', error);
              }
          }
      }

      async function deletetbl_review(ReviewID) {
          if (confirm('Are you sure you want to delete this review?')) {
              try {
                  const response = await fetch(`${API_URL}/api/tbl_review/${ReviewID}`, {
                      method: 'DELETE',
                  });

                  if (response.ok) {
                      alert('Review deleted successfully');
                      fetchtbl_review();
                  } else {
                      alert('Failed to delete review');
                  }
              } catch (error) {
                  console.error('Failed to delete review:', error);
              }
          }
      }

      document.addEventListener('DOMContentLoaded', () => {
          fetchtbl_review();
      });
  </script>
</body>
</html>
